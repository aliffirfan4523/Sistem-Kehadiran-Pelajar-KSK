<?php require_once('../Connections/local.php'); ?><?php//initialize the sessionif (!isset($_SESSION)) {  session_start();}date_default_timezone_set("Asia/Kuala_Lumpur");// ** Logout the current user. **$logoutAction = $_SERVER['PHP_SELF']."?doLogout=true";if ((isset($_SERVER['QUERY_STRING'])) && ($_SERVER['QUERY_STRING'] != "")){  $logoutAction .="&". htmlentities($_SERVER['QUERY_STRING']);}if ((isset($_GET['doLogout'])) &&($_GET['doLogout']=="true")){  //to fully log out a visitor we need to clear the session varialbles  $_SESSION['MM_Username'] = NULL;  $_SESSION['MM_UserGroup'] = NULL;  $_SESSION['PrevUrl'] = NULL;  unset($_SESSION['MM_Username']);  unset($_SESSION['MM_UserGroup']);  unset($_SESSION['PrevUrl']);	  $logoutGoTo = "../logout.php";  if ($logoutGoTo) {    header("Location: $logoutGoTo");    exit;  }}?><?phpif (!isset($_SESSION)) {  session_start();}if (!function_exists("GetSQLValueString")) {function GetSQLValueString($theValue, $theType, $theDefinedValue = "", $theNotDefinedValue = "") {  if (PHP_VERSION < 6) {    $theValue = get_magic_quotes_gpc() ? stripslashes($theValue) : $theValue;  }  $theValue = function_exists("mysql_real_escape_string") ? mysql_real_escape_string($theValue) : mysql_escape_string($theValue);  switch ($theType) {    case "text":      $theValue = ($theValue != "") ? "'" . $theValue . "'" : "NULL";      break;        case "long":    case "int":      $theValue = ($theValue != "") ? intval($theValue) : "NULL";      break;    case "double":      $theValue = ($theValue != "") ? doubleval($theValue) : "NULL";      break;    case "date":      $theValue = ($theValue != "") ? "'" . $theValue . "'" : "NULL";      break;    case "defined":      $theValue = ($theValue != "") ? $theDefinedValue : $theNotDefinedValue;      break;  }  return $theValue;}}$editFormAction = $_SERVER['PHP_SELF'];if (isset($_SERVER['QUERY_STRING'])) {  $editFormAction .= "?" . htmlentities($_SERVER['QUERY_STRING']);}if ((isset($_POST["MM_insert"])) && ($_POST["MM_insert"] == "form")) {  $nama = $_POST['nama_pelajar'];  $tahun = $_POST['current_year'];  $masa = $_POST['attendance_time'];  $tarikh = $_POST['attendance_date'];  mysql_select_db($database_local, $local);  // Check if the same data already exists in the table  $checkQuery = sprintf("SELECT * FROM kehadiran WHERE nama = %s AND tahun = %s AND tarikh = %s",    GetSQLValueString($nama, "text"),    GetSQLValueString($tahun, "int"),    GetSQLValueString($tarikh, "date"));  $checkResult = mysql_query($checkQuery, $local) or die(mysql_error());  if (mysql_num_rows($checkResult) > 0) {    // Data already exists, show alert    echo '<script>alert("Data Kehadiran Telah Wujud")</script>';  } else {    // Data doesn't exist, insert into database    $insertSQL = sprintf("INSERT INTO kehadiran (nama, tahun, masa, tarikh) VALUES (%s, %s, %s, %s)",                         GetSQLValueString($nama, "text"),                         GetSQLValueString($tahun, "int"),                         GetSQLValueString($masa, "date"),                         GetSQLValueString($tarikh, "date"));    $Result1 = mysql_query($insertSQL, $local) or die(mysql_error());    // Show success message    echo '<script>alert("Kehadiran Telah Berjaya Diisi")</script>';  }  $insertGoTo = "semakkehadiran.php";  if (isset($_SERVER['QUERY_STRING'])) {    $insertGoTo .= (strpos($insertGoTo, '?')) ? "&" : "?";    $insertGoTo .= $_SERVER['QUERY_STRING'];  }}$colname_Recordset1 = "-1";if (isset($_SESSION['matric_no'])) {  $colname_Recordset1 = $_SESSION['matric_no'];}mysql_select_db($database_local, $local);$query_Recordset1 = sprintf("SELECT nama, tahun FROM pelajar WHERE no_matrik = %s", GetSQLValueString($colname_Recordset1, "text"));$Recordset1 = mysql_query($query_Recordset1, $local) or die(mysql_error());$row_Recordset1 = mysql_fetch_assoc($Recordset1);$totalRows_Recordset1 = mysql_num_rows($Recordset1);$colname_rekod_isi_kehadiran = "-1";if (isset($_SESSION['current_date'])) {  $colname_rekod_isi_kehadiran = $_SESSION['current_date'];}mysql_select_db($database_local, $local);$query_rekod_isi_kehadiran = sprintf("SELECT * FROM kehadiran WHERE tarikh = %s", GetSQLValueString($colname_rekod_isi_kehadiran, "date"));$rekod_isi_kehadiran = mysql_query($query_rekod_isi_kehadiran, $local) or die(mysql_error());$row_rekod_isi_kehadiran = mysql_fetch_assoc($rekod_isi_kehadiran);$totalRows_rekod_isi_kehadiran = mysql_num_rows($rekod_isi_kehadiran);$colname_semak_kehadiran_pelajar = "";if (isset($_GET['nama_pelajar'])) {  $colname_semak_kehadiran_pelajar = $_GET['nama_pelajar'];}$tarikh_hari_semak_kehadiran_pelajar = "";if (isset($_SESSION['current_date'])) {  $tarikh_hari_semak_kehadiran_pelajar = $_SESSION['current_date'];}mysql_select_db($database_local, $local);$query_semak_kehadiran_pelajar = sprintf("SELECT * FROM kehadiran WHERE nama = %s  AND tarikh = %s", GetSQLValueString($colname_semak_kehadiran_pelajar, "text"),GetSQLValueString($tarikh_hari_semak_kehadiran_pelajar, "text"));$semak_kehadiran_pelajar = mysql_query($query_semak_kehadiran_pelajar, $local) or die(mysql_error());$row_semak_kehadiran_pelajar = mysql_fetch_assoc($semak_kehadiran_pelajar);$totalRows_semak_kehadiran_pelajar = mysql_num_rows($semak_kehadiran_pelajar);?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><script type = "text/javascript" src="../script.js"></script><link rel="stylesheet" href="../css/sidebar.css"><link rel="stylesheet" href="../css/header.css"><title>Sistem Kehadiran Pelajar KSK</title><style>		label {			display: list-item;			margin-bottom: 10px;		}		input[type="datetime-local"] {			width: 250px;			padding: 5px;			font-size: 16px;			border: 1px solid #ccc;			border-radius: 4px;		}		input[type="submit"] {			background-color: #4CAF50;			color: white;			padding: 10px 20px;			border: none;			border-radius: 4px;			cursor: pointer;			margin-top: 10px;		}	</style></head><body>	<header class="site-header">        <div id="mySidenav" class="sidenav">          <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>          <a href="javascript:void(0)" onclick="closeNav()">Isi Kehadiran</a>          <a href="<?php echo $logoutAction ?>">Log Keluar</a>        </div>      <div class="site-identity">      	<span style="font-size:30px;cursor:pointer; color:#FFFFFF" onclick="openNav()">&#9776;</span>                <h1><a href="#">Sistem Kehadiran Pelajar KSK</a></h1>      </div>        <nav class="site-navigation">        <ul class="nav">          <li><a href="<?php echo $logoutAction ?>">Log Keluar</a></li>        </ul>      </nav>    </header>    <div style="text-align:center; margin-top: 100px; color:#FFFFFF">  <form action="<?php echo $editFormAction; ?>" name="form" method="POST">    <label for="nama_pelajar">Enter Student Name:</label>    <input style="width: 20%; text-align:center;"  value="<?php echo $row_Recordset1['nama']; ?>" name="nama_pelajar" type="text" id="nama_pelajar" readonly />   		<label for="attendance_date">Enter Current Year:</label>    <input style="width: 20%; text-align:center;" name="current_year" type="text" value="<?php echo $row_Recordset1['tahun']; ?>" readonly />		<label for="attendance_date">Enter attendance date:</label>		<input type="date" id="attendance_date" name="attendance_date" required readonly>		<label for="attendance_time">Enter attendance time:</label>		<input type="time" id="attendance_time" name="attendance_time" required readonly>    <input type="submit" value="Submit" style="background: linear-gradient(45deg, #49a09d, #5f2c82);"><input type="hidden" name="MM_insert" value="form" />  </form></div><script>	// Get the current date and time	var currentDate = new Date();			// Format the date and time strings	var dateString = currentDate.toISOString().slice(0,10);	var timeString = currentDate.toTimeString().slice(0,5);		// Set the input field values to the current date and time	document.getElementById("attendance_date").value = dateString;	document.getElementById("attendance_time").value = timeString;</script></body></html><?phpmysql_free_result($Recordset1);mysql_free_result($rekod_isi_kehadiran);mysql_free_result($semak_kehadiran_pelajar);?>